2025/08/06 21:26:20 server.go:130: 添加上游服务 - 类型: hello, 地址: [localhost:8081]
2025/08/06 21:26:20 server.go:130: 添加上游服务 - 类型: business, 地址: [localhost:8082]
2025/08/06 21:26:20 server.go:130: 添加上游服务 - 类型: zone, 地址: [localhost:8083]
2025/08/06 21:26:20 server.go:146: 上游服务初始化完成 - 总服务数: 3, 已启用: 3
2025/08/06 21:26:20 server.go:98: START消息异步处理器使用默认配置 - Workers: 100, 队列: 1000, 超时: 30s
2025/08/06 21:26:20 overload_protector.go:155: 过载保护器已启用 - 最大连接: 1000, 最大QPS: 2000, 最大上游并发: 100
2025/08/06 21:26:20 server.go:152: 启动网关服务器...
2025/08/06 21:26:20 server_utils.go:62: 已初始化上游服务连接管理器 - 配置服务数: 3
2025/08/06 21:26:20 manager.go:87: 已连接到上游服务: localhost:8083
2025/08/06 21:26:20 server_utils.go:51: 预连接上游服务成功 - zone
2025/08/06 21:26:20 manager.go:87: 已连接到上游服务: localhost:8082
2025/08/06 21:26:20 server_utils.go:51: 预连接上游服务成功 - business
2025/08/06 21:26:20 manager.go:87: 已连接到上游服务: localhost:8081
2025/08/06 21:26:20 server_utils.go:51: 预连接上游服务成功 - hello
2025/08/06 21:26:20 server_start.go:37: QUIC监听器已启动: :8080
2025/08/06 21:26:20 server_start.go:80: HTTP服务器已启动: :8090
2025/08/06 21:26:20 server_start.go:94: 监控服务器已启动: :9090
2025/08/06 21:26:20 start_processor.go:91: 启动START消息异步处理器 - Workers: 100, 队列大小: 1000, 超时: 30s
2025/08/06 21:26:20 server.go:186: START消息异步处理器已启动
2025/08/06 21:26:20 server.go:202: 网关服务器启动完成
2025/08/06 21:26:20 server.go:203: QUIC监听地址: :8080
2025/08/06 21:26:20 server.go:204: HTTP监听地址: :8090
2025/08/06 21:26:20 server.go:205: gRPC监听地址: :8092
2025/08/06 21:26:20 server.go:206: 监控地址: :9090
2025/08/06 21:26:20 server.go:207: 上游服务地址: 
2025/08/06 21:26:20 main.go:291: 网关服务器正在运行... (按Ctrl+C停止)
2025/08/06 21:26:20 server_start.go:112: gRPC服务器已启动: :8092
2025/08/06 21:26:23 server_connection.go:75: 新的QUIC连接: 127.0.0.1:58824
2025/08/06 21:26:23 server_connection.go:87: 等待第一个消息以获取身份标识 - 连接: 127.0.0.1:58824
2025/08/06 21:26:23 server_connection.go:140: 从第一个消息中提取身份信息 - OpenID: 30200, ClientID: client_3132372e302e302e313a3538383234
2025/08/06 21:26:23 server_connection.go:144: 根据第一个消息提取出session - sessionid: f511f60f-ceb8-4511-bfae-41f7fbc412e2
2025/08/06 21:26:23 server_connection.go:165: 创建会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2
2025/08/06 21:26:23 server_connection.go:270: 处理消息 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 读取时间: 2025-08-06 21:26:23.2358704 +0800 CST m=+2.770274601, 处理开始时间: 2025-08-06 21:26:23.2358704 +0800 CST m=+2.770274601
2025/08/06 21:26:23 handlers.go:315: 同步处理start请求 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 消息ID: 1
2025/08/06 21:26:23 handlers.go:358: 同步处理start请求 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 消息ID: 1
2025/08/06 21:26:23 ordered_sender.go:63: 为会话设置发送回调函数 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2
2025/08/06 21:26:23 ordered_sender.go:115: 有序消息发送成功 - 序列号: 1, 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 发送时延: 0.00ms
2025/08/06 21:26:23 ordered_sender.go:77: 消息已加入有序队列 - 序列号: 1, 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 类型: 1
2025/08/06 21:26:23 handlers.go:424: 同步处理连接建立请求成功 - OpenID: 30200, 客户端: 30200, 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 状态: 0
2025/08/06 21:26:23 server_connection.go:347: 消息处理完成 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 类型: 1, 成功: true, 处理时延: 0.00ms
2025/08/06 21:26:23 server_connection.go:225: 开始事件驱动消息处理 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2
2025/08/06 21:26:23 server_connection.go:191: 启动异步读取协程 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2
2025/08/06 21:26:23 server_connection.go:270: 处理消息 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 读取时间: 2025-08-06 21:26:23.2364542 +0800 CST m=+2.770858401, 处理开始时间: 2025-08-06 21:26:23.2364542 +0800 CST m=+2.770858401
2025/08/06 21:26:23 ordered_sender.go:205: 会话序列号重同步完成 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 客户端ACK: 1
2025/08/06 21:26:23 handlers.go:290: 收到ACK确认 - 序列号: 1, 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 清除消息数: 1
2025/08/06 21:26:23 server_connection.go:347: 消息处理完成 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 类型: 5, 成功: true, 处理时延: 0.00ms
2025/08/06 21:26:25 server_connection.go:270: 处理消息 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 读取时间: 2025-08-06 21:26:25.1447763 +0800 CST m=+4.679180501, 处理开始时间: 2025-08-06 21:26:23.2364542 +0800 CST m=+2.770858401
2025/08/06 21:26:25 handlers.go:53: 处理业务请求 - 动作: f511f60f-ceb8-4511-bfae-41f7fbc412e2
2025/08/06 21:26:25 handlers.go:140: 路由业务请求 - 动作: hello, 目标服务: hello(localhost:8081)
2025/08/06 21:26:25 handlers.go:245: 登录成功，会话已激活 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, GID: 30200, Zone: 1
2025/08/06 21:26:25 ordered_sender.go:115: 有序消息发送成功 - 序列号: 2, 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 发送时延: 0.00ms
2025/08/06 21:26:25 ordered_sender.go:77: 消息已加入有序队列 - 序列号: 2, 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 类型: 3
2025/08/06 21:26:25 handlers.go:197: 处理业务请求 - 动作: hello, 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 响应码: 200, 时延: 解析=0.54ms, 上游=2.04ms
2025/08/06 21:26:25 server_connection.go:347: 消息处理完成 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 类型: 4, 成功: true, 处理时延: 2.92ms
2025/08/06 21:26:25 server_connection.go:270: 处理消息 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 读取时间: 2025-08-06 21:26:25.1482324 +0800 CST m=+4.682636601, 处理开始时间: 2025-08-06 21:26:25.1447763 +0800 CST m=+4.679180501
2025/08/06 21:26:25 ordered_sender.go:205: 会话序列号重同步完成 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 客户端ACK: 2
2025/08/06 21:26:25 handlers.go:290: 收到ACK确认 - 序列号: 2, 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 清除消息数: 1
2025/08/06 21:26:25 server_connection.go:347: 消息处理完成 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 类型: 5, 成功: true, 处理时延: 0.00ms
2025/08/06 21:26:53 server_connection.go:270: 处理消息 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 读取时间: 2025-08-06 21:26:53.2366597 +0800 CST m=+32.771063901, 处理开始时间: 2025-08-06 21:26:25.1482324 +0800 CST m=+4.682636601
2025/08/06 21:26:53 ordered_sender.go:115: 有序消息发送成功 - 序列号: 3, 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 发送时延: 0.00ms
2025/08/06 21:26:53 ordered_sender.go:77: 消息已加入有序队列 - 序列号: 3, 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 类型: 2
2025/08/06 21:26:53 handlers.go:46: 处理心跳请求 - 客户端: 30200, 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2
2025/08/06 21:26:53 server_connection.go:347: 消息处理完成 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 类型: 3, 成功: true, 处理时延: 0.67ms
2025/08/06 21:26:53 server_connection.go:270: 处理消息 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 读取时间: 2025-08-06 21:26:53.2380882 +0800 CST m=+32.772492401, 处理开始时间: 2025-08-06 21:26:53.2366597 +0800 CST m=+32.771063901
2025/08/06 21:26:53 ordered_sender.go:205: 会话序列号重同步完成 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 客户端ACK: 3
2025/08/06 21:26:53 handlers.go:290: 收到ACK确认 - 序列号: 3, 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 清除消息数: 1
2025/08/06 21:26:53 server_connection.go:347: 消息处理完成 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 类型: 5, 成功: true, 处理时延: 0.00ms
2025/08/06 21:27:23 server_connection.go:270: 处理消息 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 读取时间: 2025-08-06 21:27:23.2363762 +0800 CST m=+62.770780401, 处理开始时间: 2025-08-06 21:26:53.2380882 +0800 CST m=+32.772492401
2025/08/06 21:27:23 ordered_sender.go:115: 有序消息发送成功 - 序列号: 4, 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 发送时延: 0.00ms
2025/08/06 21:27:23 ordered_sender.go:77: 消息已加入有序队列 - 序列号: 4, 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 类型: 2
2025/08/06 21:27:23 handlers.go:46: 处理心跳请求 - 客户端: 30200, 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2
2025/08/06 21:27:23 server_connection.go:347: 消息处理完成 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 类型: 3, 成功: true, 处理时延: 0.00ms
2025/08/06 21:27:23 server_connection.go:270: 处理消息 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 读取时间: 2025-08-06 21:27:23.237043 +0800 CST m=+62.771447201, 处理开始时间: 2025-08-06 21:27:23.2363762 +0800 CST m=+62.770780401
2025/08/06 21:27:23 ordered_sender.go:205: 会话序列号重同步完成 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 客户端ACK: 4
2025/08/06 21:27:23 handlers.go:290: 收到ACK确认 - 序列号: 4, 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 清除消息数: 1
2025/08/06 21:27:23 server_connection.go:347: 消息处理完成 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 类型: 5, 成功: true, 处理时延: 0.00ms
2025/08/06 21:27:53 server_connection.go:270: 处理消息 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 读取时间: 2025-08-06 21:27:53.2357132 +0800 CST m=+92.770117401, 处理开始时间: 2025-08-06 21:27:23.237043 +0800 CST m=+62.771447201
2025/08/06 21:27:53 ordered_sender.go:115: 有序消息发送成功 - 序列号: 5, 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 发送时延: 0.00ms
2025/08/06 21:27:53 ordered_sender.go:77: 消息已加入有序队列 - 序列号: 5, 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 类型: 2
2025/08/06 21:27:53 handlers.go:46: 处理心跳请求 - 客户端: 30200, 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2
2025/08/06 21:27:53 server_connection.go:347: 消息处理完成 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 类型: 3, 成功: true, 处理时延: 0.00ms
2025/08/06 21:27:53 server_connection.go:270: 处理消息 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 读取时间: 2025-08-06 21:27:53.2362829 +0800 CST m=+92.770687101, 处理开始时间: 2025-08-06 21:27:53.2357132 +0800 CST m=+92.770117401
2025/08/06 21:27:53 ordered_sender.go:205: 会话序列号重同步完成 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 客户端ACK: 5
2025/08/06 21:27:53 handlers.go:290: 收到ACK确认 - 序列号: 5, 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 清除消息数: 1
2025/08/06 21:27:53 server_connection.go:347: 消息处理完成 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 类型: 5, 成功: true, 处理时延: 0.00ms
2025/08/06 21:28:23 server_connection.go:217: 读取消息出错，退出读取协程 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 错误: 读取消息头失败: timeout: no recent network activity
2025/08/06 21:28:23 server_connection.go:254: 读取消息失败 - 会话: f511f60f-ceb8-4511-bfae-41f7fbc412e2, 错误: 读取消息头失败: timeout: no recent network activity
2025/08/06 21:33:42 main.go:294: 收到停止信号，正在关闭服务器...
2025/08/06 21:33:42 server.go:214: 正在停止网关服务器...
2025/08/06 21:33:42 start_processor.go:101: 停止START消息异步处理器...
2025/08/06 21:33:42 start_processor.go:104: START消息异步处理器已停止
2025/08/06 21:33:42 server.go:248: START消息异步处理器已停止
2025/08/06 21:33:42 manager.go:153: 上游服务管理器已关闭
2025/08/06 21:33:42 server.go:278: 网关服务器已停止
2025/08/06 21:33:42 main.go:300: 服务器已停止
